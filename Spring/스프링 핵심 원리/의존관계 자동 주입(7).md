## 다양한 의존관계 주입 방법
### 생성자 주입
- 이름 그대로 생성자를 통해 의존 관계를 주입
- 지금까지 나왔던 예시에서 사용된 방법
- 특징
  - 생성자 호출 시점에 딱 한 번만 호출되는 것이 보장됨
    - 이후 세팅 변경을 방지할 수 있음
  - **불변, 필수** 의존관계에 사용
    - 따로 getter, setter 메서드를 만들지 말고 막아 놓자
      - 변경하면 안되는 값이라는 의견 피력 필요
```java
@Component
public class OrderServiceImpl implements OrderService {

    // 주문하려면 회원 저장소와 할인 정책이 필요하겠지?
    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;

    @Autowired
    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }
}
```
- 생성자가 단 한 개만 있다면 @Autowired를 생략해도 자동 주입
  - 스프링 빈에만 해당
### 수정자 주입(setter 주입)
- 필드의 값을 변경하는 setter(수정자) 메서드를 통해 의존관계 주입
- 특징
  - **선택, 변경** 가능성이 있는 의존관계에 사용
  - 자바 빈 property 규약의 수정자 메서드 방식을 사용하는 방법
    - 필드의 값을 직접 변경하지 않고, setXxx, getXxx 라는 메서드를 통해 값을 읽거나 수정하게 함
```java
public class OrderServiceImpl implements OrderService {

    private MemberRepository memberRepository;
    
    private DiscountPolicy discountPolicy;
    
    @Autowired
    public void setMemberRepository(MemberRepository memberRepository){
        this.memberRepository = memberRepository;
    }
    
    @Autowired
    public void setDiscountPolicy(DiscountPolicy discountPolicy){
        this.discountPolicy = discountPolicy;
    }
}
```
> 참고: `@Autowired`의 기본 동작은 주입할 대상이 없으면 오류가 발생한다

> 주입할 대상이 없어도 동작하게 하려면(선택적으로 사용 시) `@Autowired(required = false)`로 지정하면 된다.
### 필드 주입
- 필드에 바로 주입하는 방법
- 특징
  - 코드가 간결해 편리해 보이지만 외부에서 변경이 불가능해 테스트가 어려움
    - 테스트를 하려면 setter가 있어야 하는데, 그럴거면..
  - DI 프레임워크가 없으면 아무것도 할 수 없음
    - 순수한 자바코드로 테스트 불가능
  - 사용하지 말 것 
    - 애플리케이션의 실제 코드와 관계 없는 테스트 코드에선 사용 가능
    - 스프링 설정을 목적으로 하는 @Configuration 같은 곳에서만 특별한 용도로 사용
```java
@Component
public class OrderServiceImpl implements OrderService{
    @Autowired
    private MemberRepository memberRepository;
    
    @Autowired
    private DiscountPolicy discountPolicy;
}
```
### 일반 메서드 주입
- 일반 메서드를 통해 주입 받을 수 있음
- 특징
  - 한 번에 여러 필드를 주입 받을 수 있음
  - 일반적으로 잘 사용하지 않음
```java
@Component
public class OrderSerivceImpl implements OrderService{

    private MemberRepository memberRepository;
    private DiscountPolicy discountPolicy;

    @Autowired
    public void init(MemberRepository memberRepository, DiscountPolicy discountPolicy){
        this.memberRepository = memberRepository;
        this.DiscountPolicy = discountPolicy;
    }
}
```
- 의존관계 자동 주입은 스프링 컨테이너가 관리하는 스프링 빈에서만 동작
  - 스프링 빈에서만 `@Autowired`를 사용하도록 하자
## 옵션 처리
- 주입할 스프링 빈이 없어도 동작해야 할 때가 있음
  - `@Autowired`만 사용 시 `required` 옵션의 기본값이 `true`로 되어 있어 자동주입 대상이 없으면 오류 발생
- 자동 주입 대상을 옵션으로 처리하는 방법
  - `Autowired(required=false)`
    - 자동 주입할 대상이 없으면 수정자 메서드 자체가 호출 안됨
  - `org.springframework.lang.@Nullable`
    - 자동 주입할 대상이 없으면 null이 입력됨
  - `Optional<>`
    - 자동 주입할 대상이 없으면 `Optional.empty` 입력됨

```java
public class AutowiredTest {

    @Test
    void AutowiredOption(){
        ApplicationContext ac = new AnnotationConfigApplicationContext(TestBean.class);
    }

    static class TestBean {
        //호출 안됨
        @Autowired(required = false)
        public void setNoBean1(Member member) {
            System.out.println("setNoBean1 = " + member);
            // 출력 안됨
            // required = true가 기본값
            // required = true로 설정 시, meber 변수가 없으므로 오류가 출력된다
        }

        //null 호출
        @Autowired
        public void setNoBean2(@Nullable Member member) {
            System.out.println("setNoBean2 = " + member);
            //setNoBean2 = null 출력
        }

        //Optional.empty 호출
        @Autowired(required = false)
        public void setNoBean3(Optional<Member> member) {
            System.out.println("setNoBean3 = " + member);
            //setNoBean3 = Optional.empty 출력
        }
    }
}
```
- **Member는 스프링 빈이 아님**
- `setNoBean1()`은 `@Autowired(required=false)` 이므로 호출 자체가 안됨

> 참고: @Nullabe, Optional은 스프링 전반에 걸쳐서 지원됨

> 예를 들어 생성자 자동 주입에서 특정 필드에만 사용 가능하다 (인자 중 한개가 없어도 스프링 빈 생성 가능하다) 
## 생성자 주입을 선택해라!
## 롬복과 최신 트렌드
## 조회 빈이 2개 이상 - 문제
## @Autowired 필드명, @Qualifier, @Primary
## 애노테이션 직접 만들기
## 조회한 빈이 모두 필요할 때, List, Map
## 자동, 수동의 올바른 실무 운영 기준
