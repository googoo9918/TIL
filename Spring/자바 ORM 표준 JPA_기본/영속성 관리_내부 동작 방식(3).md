## 영속성 컨텍스트1
### 엔티티 매니저 팩토리와 엔티티 매니저
- ![image](https://user-images.githubusercontent.com/102513932/199769714-850c01b7-aa6a-4079-8f15-84e8ac22c349.png)
  - 고객 요청이 올때 마다 EntityManagerFactory를 통해 EntityManager를 생성함
  - EntityManager는 내부적으로 데이터베이스 커넥션을 활용, DB를 사용함
- 영속성 컨텍스트
  - JPA를 이해하는데 가장 중요한 용어
  - **엔티티를 영구 저장하는 환경**
    - EntityManager.persist(entity);
      - 사실 DB에 저장하는게 아니라, entity를 영속성 컨텍스트를 통해 영속화 하는 것
      - 영속화 : entity를 영속성 컨텍스트에 저장
- 엔티티 매니저? 영속성 컨텍스트?
  - 영속성 컨텍스트는 논리적 개념
    - 눈에 보이지 않음
  - 엔티티 매니저를 통해 영속성 컨텍스트에 접근
- ![image](https://user-images.githubusercontent.com/102513932/199771034-9dd2abb9-6e61-4607-8fa8-b0d03e066120.png)
  - EntityManager 생성 시 영속성 컨텍스트가 생성
    - EntityManager 안에 눈에 보이지 않는 공간이 생긴다 이해할 것
### 엔티티의 생명주기
- 비영속(new/transient)
  - 최초의 멤버 객체를 생성한 상태
  - 영속성 컨텍스트와 전혀 관계가 없는 **새로운** 상태
- 영속(managed)
  - `EntityManager.persist(entity);`
  - 영속성 컨텍스트에 **관리**되는 상태
- 준영속(detached)
  - 영속성 컨텍스트에 저장되었다가 **분리**된 상태
- 삭제(removed)
  - **삭제**된 상태
- ![image](https://user-images.githubusercontent.com/102513932/199772035-a7f6940e-c3f1-4980-a6f3-c6e8466e7d07.png)

### 비영속
- ![image](https://user-images.githubusercontent.com/102513932/199772171-2adb6334-ca81-4d10-8d67-322dcec2afe8.png)
  - 최초의 멤버 객체를 생성한 상태
  - JPA와 전혀 연관없는 상태
### 영속
- ![image](https://user-images.githubusercontent.com/102513932/199772272-c8f2790e-7ab6-46c8-b1d6-46554534acaa.png)
  - `EntityManager.persist(entity);`
  - entityManger 안에 있는 영속성 컨텍스트를 통해 entity가 관리 되는 상태가 됨
    - 이전에는 DB에 저장하는 것이라 알고 있었지만, 영속 상태가 된다고 바로 DB에 쿼리가 전송되는 것이 아님
    - Transaction을 커밋하는 시점에 영속성 컨텍스트가 있는 객체가 DB에 쿼리가 전송됨
### 준영속, 삭제
- ![image](https://user-images.githubusercontent.com/102513932/199773030-3d83bfdd-bde7-4f68-a411-722e027b8cca.png)

### 영속성 컨텍스트의 이점
- 1차 캐시
- 동일성(identity) 보장
- 트랜잭션을 지원하는 쓰기 지연 (transactional wirte-behind)
- 변경 감지(Dirty Checking)
- 지연 로딩(Lazy Loading)
## 영속성 컨텍스트2
## 플러시
## 준영속 상대
## 정리