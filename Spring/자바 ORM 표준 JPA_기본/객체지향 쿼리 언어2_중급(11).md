### 목차
- [경로 표현식](#경로-표현식)
  - [경로 표현식 용어 정리](#경로-표현식-용어-정리)
  - [경로 표현식 특징](#경로-표현식-특징)
  - [단일 값 연관 경로 탐색](#단일-값-연관-경로-탐색)
  - [명시적 조인, 묵시적 조인](#명시적-조인-묵시적-조인)
  - [경로 표현식 - 예제](#경로-표현식---예제)
  - [경로 탐색을 사용한 묵시적 조인 시 주의사항](#경로-탐색을-사용한-묵시적-조인-시-주의사항)
  - [실무 조언](#실무-조언)
- [페치 조인 1 - 기본](#페치-조인-1---기본)
  - [엔티티 페치 조인](#엔티티-페치-조인)
  - [컬렉션 페치 조인 사용 코드](#컬렉션-페치-조인-사용-코드)
- [페치 조인 2 - 한계](#페치-조인-2---한계)
- [다형성 쿼리](#다형성-쿼리)
- [엔티티 직접 사용](#엔티티-직접-사용)
- [Named 쿼리](#named-쿼리)
- [벌크 연산](#벌크-연산)
## 경로 표현식
- .(점)을 찍어 객체 그래프를 탐색하는 것
```java
select m.username // 상태 필드
 from Member m
  join m.team t // 단일 값 연관 필드
  // 엔티티로 넘어간 상황, ManyToOne 이거나 OneToOne 일것임
  join m.orders O // 컬렉션 값 연관 필드
  // 세가지를 꼭 구분할 수 있어야 함
where t.name = '팀A'
```
### 경로 표현식 용어 정리
- 상태 필드(state field): 단순히 값을 저장하기 위한 필드
  - ex) m.username
- 연관 필드(association field): 연관관계를 위한 필드
  - 단일 값 연관 필드
    - `@ManyToOne`, `@OneToOne`, **대상이 엔티티**(ex: m.team)
  - 컬렉션 값 연관 필드
    - `@OneToMany`, `@ManyToMany`, **대상이 컬렉션**(ex: m.orders)
### 경로 표현식 특징
- 상태 필드(state field): 경로 탐색의 끝, 더 이상 탐색 불가능
- 단일 값 연관 경로: **묵시적 내부 조인(inner join) 발생**, 더 탐색 가능
  - ex) `m.team` -> `m.team.name`
  - from 절에서 Member와 Team을 join한 후 select에 나열함
    - 객체 입장에서는 `.` 통해 접근 가능하지만 DB에서는 join이 필수적임 --> 묵시적 내부 조인 발생!
    - 예상치 못한 쿼리가 나가기 때문에, 조심해서 사용해야함
    - 쿼리 튜닝을 할 때 상당한 어려움이 있을 수 있음 
- 컬렉션 값 연관 경로: **묵시적 내부 조인 발생**, 더 이상 탐색 불가능
  - ex) `select t.members From Team t`
    - members가 컬렉션이고, 값이 여러개 들어있을 수 있기 때문에 어떤 값을 선택해서 어떤 필드를 꺼내야할지 어려움이 있음
      - JPA에서 더 이상 탐색 불가능하게 제약을 검
      - 사실 컬렉션에서 필드를 찾는다는 것 자체가 어불성설임  
  - FROM 절에서 명시적 조인을 통해 별칭을 얻으면 별칭을 통해 탐색 가능
    - `select m From Team t join t.members m`
      - 이후 m을 통해 탐색 가능!
        - ex) m.username

### 단일 값 연관 경로 탐색
- JPQL: `select o.member from Order o`
- SQL:
    ```sql
    SELECT m.*
    FROM Orders o
    inner join Member m on o.member_id = m.id
    ```
    - 묵시적 조인 발생함, 사용하지 말 것
### 명시적 조인, 묵시적 조인
- 명시적 조인: join 키워드 직접 사용
  - `select m from Member m join m.team t`
- 묵시적 조인: 경로 표현식에 의해 묵시적으로 SQL 조인 발생 (내부 조인만 가능)
  - `select m.team from Member m`
  - 사용하지 말 것!!!!!
### 경로 표현식 - 예제
- `select o.member.team from Order o` -> 성공
  - 묵시적 조인이 2번 일어남, 사용하지 말 것!!
- `select t.members from Team` -> 성공
  - 컬렉션 값 연관관계
- `select t.members.username from Team t` -> 실패
  - 컬렉션에서 더 이상 필드를 찾을 수 없음!
- `select m.username from Team t join t.members m` -> 성공
  - 명시적 조인
### 경로 탐색을 사용한 묵시적 조인 시 주의사항
- 항상 내부 조인
- 컬렉션은 경로 탐색의 끝, 명시적 조인을 통해 별칭을 얻어야함
- 경로 탐색은 주로 SELECT, WHERE 절에서 사용하지만 묵시적 조인으로 인해 SQL의 FROM(JOIN)절에 영향을 줌
### 실무 조언
- **가급적 묵시적 조인 대신 명시적 조인 사용**
- 조인은 SQL 튜닝에 중요 포인트
- 묵시적 조인은 조인이 일어나는 상황을 한눈에 파악하기 어려움 
## 페치 조인 1 - 기본
- 페치 조인(fetch join)
  - SQL 조인 종류X
  - JPQL에서 성능 최적화를 위해 제공하는 기능
  - 연관된 엔티티나 컬렉션을 SQL 한 번에 함께 조회하는 기능
  - join fetch 명령어 사용
  - 페치 조인 `:: = [LEFT [OUTER] | INNER ] JOIN FETCH 조인경로`
### 엔티티 페치 조인
- 회원을 조회하면서 연관된 팀도 함께 조회(SQL 한 번에)
- SQL을 보면 회원 뿐 아니라 팀(T.*)도 함께 SELECT
- JPQL
  - select m from Member m join fetch m.team
- SQL
  ```sql
  SELECT M.*, T.* FROM MEMBER M
  INNER JOIN TEAM T ON M.TEAM_ID = T.ID
  ```
  - ![image](https://user-images.githubusercontent.com/102513932/201101121-ec5fa9b7-b863-47f9-a6da-6860e9a47a34.png)
  - ![image](https://user-images.githubusercontent.com/102513932/201101150-7af5761e-0515-44af-938a-28c006af89f5.png)

### 컬렉션 페치 조인 사용 코드
## 페치 조인 2 - 한계
## 다형성 쿼리
## 엔티티 직접 사용
## Named 쿼리
## 벌크 연산 